<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="lemoon.can.milkyway.infrastructure.repository.query.FriendApplicationQueryRepository">

    <resultMap id="FriendApplicationDOMap" type="lemoon.can.milkyway.infrastructure.repository.dos.FriendApplicationDO">
        <id property="id" column="id"/> <!-- 主键 -->
        <result property="applyMsg" column="apply_msg"/> <!-- 普通字段 -->

        <association property="fromUser" javaType="lemoon.can.milkyway.infrastructure.repository.dos.UserDO">
            <result property="openId" column="from_open_id"/>
            <result property="nickName" column="from_nick_name"/>
            <result property="avatar" column="from_avatar"/>
        </association>
        <association property="toUser" javaType="lemoon.can.milkyway.infrastructure.repository.dos.UserDO">
            <result property="openId" column="to_open_id"/>
            <result property="nickName" column="to_nick_name"/>
            <result property="nickName" column="to_avatar"/>
        </association>
    </resultMap>

    <select id="findApplications" resultMap="FriendApplicationDOMap">
        select fa.id        as id,
               fa.apply_msg as apply_msg,
               u1.open_id   as from_open_id,
               u1.nick_name as from_nick_name,
               u1.avatar    as from_avatar,
               u2.open_id   as to_open_id,
               u2.nick_name as to_nick_name,
               u2.avatar    as to_avatar
        from friend_application fa
                 left join users u1 on fa.from_user_id = u1.id
                 left join users u2 on fa.to_user_id = u2.id
        where fa.to_user_id = #{toUserId}
    </select>

</mapper>